<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type='text/javascript'    src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
</head>
<body>


<script>


function print_filter(filter){
	var f=eval(filter);
	if (typeof(f.length) != "undefined") {}else{}
	if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
	if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
	console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
}

var data =
    [{"rating": 9.37, "name": "Kimi no Na wa.", "episodes": 1, "members": 200630, "genre": "Drama, Romance, School, Supernatural", "type": "Movie"}, {"rating": 9.26, "name": "Fullmetal Alchemist: Brotherhood", "episodes": 64, "members": 793665, "genre": "Action, Adventure, Drama, Fantasy, Magic, Military, Shounen", "type": "TV"}, {"rating": 9.25, "name": "Gintama\u00b0", "episodes": 51, "members": 114262, "genre": "Action, Comedy, Historical, Parody, Samurai, Sci-Fi, Shounen", "type": "TV"}, {"rating": 9.17, "name": "Steins;Gate", "episodes": 24, "members": 673572, "genre": "Sci-Fi, Thriller", "type": "TV"}, {"rating": 9.16, "name": "Gintama'", "episodes": 51, "members": 151266, "genre": "Action, Comedy, Historical, Parody, Samurai, Sci-Fi, Shounen", "type": "TV"}, {"rating": 9.15, "name": "Haikyuu!!: Karasuno Koukou VS Shiratorizawa Gakuen Koukou", "episodes": 10, "members": 93351, "genre": "Comedy, Drama, School, Shounen, Sports", "type": "TV"}, {"rating": 9.13, "name": "Hunter x Hunter (2011)", "episodes": 148, "members": 425855, "genre": "Action, Adventure, Shounen, Super Power", "type": "TV"}, {"rating": 9.11, "name": "Ginga Eiyuu Densetsu", "episodes": 110, "members": 80679, "genre": "Drama, Military, Sci-Fi, Space", "type": "OVA"}, {"rating": 9.1, "name": "Gintama Movie: Kanketsu-hen - Yorozuya yo Eien Nare", "episodes": 1, "members": 72534, "genre": "Action, Comedy, Historical, Parody, Samurai, Sci-Fi, Shounen", "type": "Movie"}, {"rating": 9.11, "name": "Gintama': Enchousen", "episodes": 13, "members": 81109, "genre": "Action, Comedy, Historical, Parody, Samurai, Sci-Fi, Shounen", "type": "TV"}];


var ndx = crossfilter(data);

var highRatingDim = ndx.dimension(function(d) {return d.rating;});
var genreDim = ndx.dimension(function(d) {return d.genre;});

 //Split genre values into multiple strings and count how many each genre appears in csv
       // var genreGroup = genreDim.group(function(d){return d.genre;});
       // var genreArray = splitGenreIntoStrings.split(/,/);

        var allGenreGroup = genreDim.group();
        var allGenreArray = allGenreGroup.all();



        //This object contains all fields
        var getArray = genreDim.top(10);
        //Return array of objects containing the genre string as value
        var returnGenreArray = getArray.map(function(d){return d.genre});
        var getGenreFromOneAnime = returnGenreArray['0'];


        allGenreArray.forEach(myFunction);
        function myFunction(item, index){
            for(var x in item){
                return item;
            }
        }

        //Get genres for each anime and return the percentage of occurance in list
        var checkThisGenre = '';
        //var percentage = (counter.length/100) * 10


        //Turn each word into a string
        //var arrStringEach = arrString.split(',');
    function getFrequency(string, cutOff) {

        var words = string.split(","),
            frequencies = {},
            word, frequency, i;

        for (i = 0; i < words.length; i++) {
            word = words[i];
            frequencies[word] = frequencies[word] || 0;
            frequencies[word]++;
        }

        words = Object.keys(frequencies);

        return words.sort(function (a, b) {
            return frequencies[b] - frequencies[a];
        }).slice(0, cutOff).toString();

    }
    var string = returnGenreArray.toString()

 //var names = animeByName.map(function(d){return d.name});
        //console.log(names);


        //Get array

        //var animeByGenre = getArray.map(function(d){return d.genre});
        //console.log(animeByGenre);


        //Split genre values into multiple strings and count how many each genre appears in csv

        /*
        //Row chart
        var rowChart = dc.rowChart("#bar-chart");
        rowChart
            .width(360)
            .height(350)
            .margins({top: 30, right: 30, bottom: 30, left: 30})
            .elasticX(true)
            .dimension(membersDim)
            .group(animeByRating);
        */



     /*   //Get occurences of genre from entire string
        var counter = [];
        var word = 'Comedy';
        var idx = arrString.indexOf(word);
        while (idx != -1) {
            counter.push(idx);
            idx = arrString.indexOf(word, idx + 1);
        }

        var genreAsPercent = (counter.length/100) * 10;
        console.log(genreAsPercent);



      /*  function getFields(input, field) {
            var output = [];
            for (var i=0; i < input.length ; ++i)
            output.push(input[i][field]);
            return output;
    }*/
        //var turnIntoStrings = result.split(",");

        /*function makeStrings(input){
            var output = [];
            for (var i=0; i < input.length; ++i)
                output.push(input[i].split(","));
        }*/

        //var a = makeStrings(result);

var the = "Comedy, Action, Sci-Fi, Fantasy, Shounen, Adventure, Comedy, Romance, Kids, School, Slice-of-Life, Drama, Supernatural,Drama,Hentai, Adventure, Mecha, Magic, Historical, Shoujo, Ecchi, Seinen, Sports,Fantasy, Super-Power, Mystery, Military, Parody, Space, Kids, Horror, Harem, Martial-Arts, Music, Demons, Psychological, Police, Hentai, Dementia, Historical, Samurai, Game, Music, Mecha, Slice-of-Life, Vampire, Romance, Demons, Thriller, Sci-Fi, Mystery, Horror, Shounen-Ai, Ecchi, Magic, Shoujo-Ai, Josei, School, Shounen, Sports, Harem, Yuri, Game, Cars, Yaoi, Cars, Psychological, Military, Parody, Supernatural, Shoujo, Seinen, Martial-Arts, Josei, Yaoi, Samurai, Super-Power, Vampire, Space, Thriller, Police"
var thesplit = the.split(",")
var order = thesplit.sort();
console.log(order);


var highestOne = highRatingDim.top(5);



//print_filter("highestOne");

</script>
</body>
</html>